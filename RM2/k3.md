# Multikast
## Uvod
- Stephen Deering
- Prva mreža MBone
- Koristi se isključivo UDP, mane su nedostatak pouzdanog prenosa i sigurnosti
- D klasa: 224.0.0.0 - 239.255.255.255 - sve posle prva četiri bita je Multicast Group ID
- Postoje i Multicast MAC adrese, fora je što je Stenford kupio samo jedan OUI pa se preslikava samo najnižih 23 od 28 bita IP adrese (24 bita za OUI, 1 bit=0 za Stenford)
- Segmenti:
    - Reserved link local: 224.0.0.0-224.0.0.255 (ruteri ne smeju da prosleđuju, rezervisane od IANA)
    - Globally scoped: 224.0.1.0-238.255.255.255 (delimično se rezervišu)
        - SSM: 232.0.0.0-232.255.255.255
        - GLOP: 233.0.0.0-233.255.255.255 (nisu rezervisane, AS ulazi u drugi i treći oktet)
    - Limited scope: 239.0.0.0-239.255.255.255 (ne smeju da izađu na internet, ne moraju da se rezervišu)
- IPv6 segmenti:
    - FF00::/8
    - Prvih 9 bita 111111110, sledeći su R, P, T
    - R = embedded RP
    - P = based on unicast: 64 bita su prefiks unikast adrese
    - T = temporary address (local assigned)
- ASM: Može da šalje bilo ko na istu multikast grupu
- SSM: Može da šalje samo određeni izvor
    - Od ove godine IETF dozvoljava samo SSM između AD

## SAP i SDP
- Session Announcement Protocol periodično oglašava multikast grupe korišćenjem 224.2.127.254 UDP na portu 9875
- Session Description Protocol daje opis oglašenih multikast grupa, a koristi se i za SIP IP telefoniju

## IGMP
- Internet Group Management Protocol - način da slušalac kaže ruteru šta da sluša
- IGMP se enkapsulira u IP, TTL je uvek 1
- IGMPv1:
    - Poruke: Membership Query, Membership Report
    - Ruteri periodično šalju Membership query na 224.0.0.1, slušaoci odgovaraju sa Membership report
    - Slušaoci tiho napuštaju grupu, dovod paketa se prekida nakon tri intervala
    - Report se šalje na multikast adresu, ostali slušaoci vide da je poslat i ne šalju ponovo
    - Pri dobijanju Query hostovi čekaju nasumično vreme kraće od Report vremena i na kraju toga šalju ako nije poslata
    - Postoji IGMP Querier ruter koji na jednom segmetu šalje Query poruke, zasniva se na L3 informaciji (designated router)
    - Priključivanje grupi može da se vrši preko Unsolicited Report poruke sa adresom multikasta
    - Mana: Mnogo dugačak Query timeout interval
- IGMPv2:
    - General Query, Group specific Query, V1 membership report, V2 membership report, Leave group
    - Maximum response time polje - 10s za general, 1s za group specific
    - Izbor Querier: Na General Query ruteri odgovaraju sa svojom IP adresom, Querier postaje onaj sa najnižom
    - Po dobijanju Leave poruke ruter šalje group specific query i gasi slanje nakon 2xMRT
- IGMPv3:
    - IGMPv2 ali za SSM
- IGMP za IPv6 se zove MLD (Multicast Listeners Discovery)
- IGMP snooping:
    - Rešava problem gde svičevi ne mogu da nauče na koje portove da pošalju multikast pakete
    - Svičevi onda presreću IGMP pakete i na osnovu njih uče

## Protokoli rutiranja
- DVMRP - Distance Vector Multicast Routing Protocol (ekstenzija RIP)
- MOSPF - Multicast OSPF
- CBT - Core Based Trees
- PIM - Protocol Independent Multicast

## PIM
- Source Distribution Trees:
    - Takođe Shortest Path Tree - SPT
    - Unikast IP adrese prijemnika su irelevantne
    - PIM Dense Mode
    - Gusti slušaoci a retki izvori
    - Stablo sa korenom u izvoru, za svaki izvor po stablo
    - (S, G)
    - Flood and Prune
    - Pruning se radi kada:
        - RPF provera ne uspe
        - List-ruter nema slušaoce date grupe
        - Ne-list ruter dobija Prune poruku preko point-to-point segmenta
        - Ne-list-ruter dobija Prune poruku preko LAN segmenta i nije dobio Prune override (Join)
    - Graft: Ruter koji je ranije prune-ovan ponovo traži da bude uključen u multikast stablo
    - Ako su dva rutera na istom LAN segmentu treba da se izabere jedan koji prosleđuje saobraćaj:
        - onaj koji ima bolju metriku, ili
        - onaj sa većom IP adresom, ukoliko imaju istu metriku.
- Shared Distribution Tree:
    - PIM Sparse Mode
    - (*, G)
    - Ne pruža optimalnu putanju
    - Mnogo manje stabala, manja tabela rutiranja
    - Stablo sa korenom u Rendezvous Point
    - Treba svi da znaju gde je RP jer kada dobiju IGMP poruku šalju Join
    - Povezivanje sa izvorom nije deo deljenog stabla
    - Isto postoji pruning za nepotrebne grane
    - Saobraćaj izvora se enkapsulira u Register poruku i šalje RP kao unicast
        - Ako ima slušalaca, RP šalje Join prema S i pravi SPT (S, G)
        - Ako nema, RP šalje Register-Stop, ali on stiže samo do terminalnog rutera
    - Metode otkrivanja RP:
        - Ne treba da pati od SPoF
        - Auto-RP:
            - Napravio Cisco
            - RP se oglašava RP-Announce porukama na 224.0.1.39 sa skupom grupa
            - RP Mapping Agent šalje RP Discovery poruke na 224.0.1.40 kojima oglašava RP i skup grupa
            - Koristi se PIM SDM, gde samo za gorenavedene grupe radi kao DM a za sve ostale kao SM
        - Bootstrap Router (BSR):
            - BSR dobija informacije unikastom preko c-RP Advertisement poruka
            - Šalje informaciju o mapiranju RP na grupe na 224.0.0.13 (link local adresa) a ruteri ih prosleđuju unikastom
            - Može da bude više BSR
        - Anycast RP sa MSDP:
            - Anycast adrese počinju sa 192.88
            - Mreža se deli na više delova, svaki sa svojim RP
            - RP komuniciraju preko MSDP
            - Kada dođe novi izvor, RP šalje drugim RP MSDP SA (sadržaj je adresa izvora, grupe i RP-a koji je generisao), a oni onda prave stablo prema njemu
- Koristi se unidirekciono stablo
- RPF: Multikast paket u multikast mreži će biti prihvaćen samo ako je došao sa najkraće putanje prema izvoru
- Međudomenski multikast
- MSDP:
    - Postoji RPF i za SA poruke
    - Multiprotokolarni BGP je rešenje za crne rupe u multikast rutiranju
    - Ruteri održavaju odvojene multikast ruting tabele za RPF provere
    - Postoji oznaka u MBGP paketu gde 1, 2, 3 označava da li je unikast, multikast ili obe rute

# QoS
## Osnovne karakteristike
- Gubljenje paketa (packet loss):
    - Uglavnom zbog zagušenja mreže
- Kašnjenje (latency):
    - Fiksno kašnjenje zbog neophodno dugih operacija
    - Promenljivo kašnjenje zbog zagušenja mreže
- Varijacija kašnjenja (jitter):
    - Pravi problem pri dekodovanju signala
- Propusni opseg nije karakteristika QoS, ali je potreban
- QoS modeli:
    - Best-effort (bez garancije)
    - Integrated services
        - Zahteva se i rezerviše određena usluga od mreže
        - RSVP protokol
        - Ne koristi se jer je previše granularna
    - Differentiated services
        - Svaki ruter nezavisno sprovodi servise

## Klasifikacija i obeležavanje
- Po slojevima:
    - L1: interfejs, PVC
    - L2: MAC, 102.1q/p, CoS, VLAN, MPLS/FR/ATM zaglavlja
    - L3: IP adrese, IP precedence, DSCP
    - L4: TCP ili UDP portovi
    - L7: specifični aplikativni podaci
- Klasifikacija može da pojede mnogo snage, ali ostali ruteri ne moraju da veruju labelama
- Obeležavanje se vrši na L2 ili L3:
    - Ethernet: VLAN priority polje, (Class of Service?)
        - npr. IP telefon i računar u različitim VLAN-ovima
        - Problem je što se gube labele između rutera
    - IP: IP Precedence/Type of Service/DiffServ Code Point
        - Prvobitno sa DTR bitovima (Delay, Throughput, Reliability)
        - DSCP ima 6 bita za QoS markiranje
        - Klase:
            - Best Effort
            - Expedited Forwarding
            - Assured Forwarding
            - Class Selector
- QoS metode
    - Ograničenje i poravnanje
        - Kod ograničavanja pikovi se seku a kad uobličavanja usporavaju
        - CIR = Bc/Ti
    - Kontrola zagušenja
        - Queueing: FIFO, round-robin, PQ, FQ, WFQ, CBWFQ, LLQ
    - Izbegavanje zagušenja
        - Rešenja za globalnu sinhronizaciju: RED, WRED
        - ECN: Koriste se ona dva bita
            - 00: Ne koristi ECN
            - 01, 10: Koristi ECN
            - 11: Zagušenje na krajnjim čvorovima
    - Specifične tehnike na linku
        - Link fragmentation and interleaving (nismo slušali, nema smisla)
        - Kompresija
            - Sadržaja: nema smisla, najverovatnije je već kompresovan
            - Zaglavlja: možda ima smisla, ali samo za male pakete
